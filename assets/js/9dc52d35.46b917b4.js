"use strict";(self.webpackChunkfmundane_docs=self.webpackChunkfmundane_docs||[]).push([[3985],{3905:(e,n,t)=>{t.d(n,{Zo:()=>h,kt:()=>u});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},h=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),d=c(t),u=r,m=d["".concat(l,".").concat(u)]||d[u]||p[u]||o;return t?a.createElement(m,i(i({ref:n},h),{},{components:t})):a.createElement(m,i({ref:n},h))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},9504:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=t(7462),r=(t(7294),t(3905));const o={sidebar_position:2},i="Creating Experiences",s={unversionedId:"experience",id:"experience",title:"Creating Experiences",description:"Note that experiences can be created using a modified version of Twine.  Though it is worth reading through this to get an idea of the file structure.  However, to get started with authoring, take a look at the Future Mundane Twine Repo, and read our docs here.",source:"@site/docs/experience.md",sourceDirName:".",slug:"/experience",permalink:"/fmundane-engine/docs/experience",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Caravan Intro",permalink:"/fmundane-engine/docs/intro"},next:{title:"Caravan Drivers",permalink:"/fmundane-engine/docs/category/caravan-drivers"}},l={},c=[{value:"A Caravan &#39;experience&#39; file",id:"a-caravan-experience-file",level:2}],h={toc:c};function p(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},h,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"creating-experiences"},"Creating Experiences"),(0,r.kt)("p",null,"Note that experiences can be created using a modified version of ",(0,r.kt)("a",{parentName:"p",href:"https://tlodge.github.io/fmundane-twine/"},"Twine"),".  Though it is worth reading through this to get an idea of the file structure.  However, to get started with authoring, take a look at the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/tlodge/fmundane-twine"},"Future Mundane Twine Repo"),", and read our docs here."),(0,r.kt)("p",null,"An experience consists of one or more ",(0,r.kt)("strong",{parentName:"p"},"layers.")," A layer can be thought of as a set of nodes and branching paths (i.e. a tree). A ",(0,r.kt)("strong",{parentName:"p"},"node")," is a point in an experience where things ( ",(0,r.kt)("strong",{parentName:"p"},"actions")," ) happen. So a node might turn lights white, turn the fan on and put something on the screen. "),(0,r.kt)("p",null,"Once a node has done all that it is meant to do, it will wait for an ",(0,r.kt)("strong",{parentName:"p"},"event")," , which will then cause it to optionally perform more actions and then move onto another node. The actions that are performed and the node that is moved onto will be determined by a set of ",(0,r.kt)("strong",{parentName:"p"},"rules.")," And that is basically it. There are one or more layers, so that you can have lots of different branching paths that run in parallel and which each respond to different events. In practice its most common to just have the one layer, but there are experiences that have a couple of layers (which we'll get to later)."),(0,r.kt)("p",null,"The piece of code that handles a layer is src/statemachine.js. At any point it time, the state machine will be at a particular state (i.e. node). When the state machine moves to a new node (upon seeing an event that matches a rule), it will trigger a bunch of actions. Those actions may run sequentially or in parallel. Once the actions are complete, the state machine will wait for a new event, evaluate it against a rule and move to a new node if the rule holds. The actions that the statemachine performs are calls to url endpoints.\nThe most common event is a 'button press', which is triggered by a user pressing a button on the WoZ interface. Events are sent and received over mqtt. Thus sensors and devices can trigger events by writing messages to the mqtt broker that the server is listening to. The mqtt broker in run in Docker, and info on how to start it can be found in README.md in the server directory. Layers are created by reading a json 'experience' file. We'll provide more detail now:"),(0,r.kt)("h2",{id:"a-caravan-experience-file"},"A Caravan 'experience' file"),(0,r.kt)("p",null,"Experience files are written in json. They are reasonably easy to understand but very fiddly to write. Here is an example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n   {\n      "id":"tests",\n      "start":{\n         "actions":[\n            [\n               \n            ]\n         ],\n         "event":"start"\n      },\n      "events":[\n         {\n            "type":"button",\n            "name":"start",\n            "id":"start",\n            "subscription":"/press",\n            "onstart":{\n               "actions":[\n                  [\n                     {\n                        "action":"http://[lenovo]:9102/api/media/play",\n                        "params":{\n                           "query":{\n                              "media":"TV.mp4"\n                           }\n                        },\n                        "method":"GET",\n                        "delay":0\n                     }\n                  ],\n                  [\n                     {\n                        "action":"http://[speech]:9105/api/speech",\n                        "params":{\n                           "body":{\n                              "speech":[\n                                 {\n                                    "words":"Welcome this is me!",\n                                    "voice":"Daniel",\n                                    "rate":"180",\n                                    "delay":"0"\n                                 }\n                              ]\n                           }\n                        },\n                        "method":"POST",\n                        "delay":0\n                     }\n                  ]\n               ]\n            },\n            "rules":[\n               {\n                  "rule":{\n                     "operator":"equals",\n                     "operand":"next"\n                  },\n                  "next":"saythings",\n                  "actions":[\n                     \n                  ]\n               }\n            ],\n            "data":[\n               "next"\n            ]\n         },\n         {\n            "type":"button",\n            "name":"saythings",\n            "id":"saythings",\n            "subscription":"/press",\n            "onstart":{\n               "actions":[\n                  [\n                     {\n                        "action":"http://[speech]:9105/api/speech",\n                        "params":{\n                           "body":{\n                              "speech":[\n                                 {\n                                    "words":"This is a person talking to you |address|",\n                                    "voice":"Daniel",\n                                    "rate":"180",\n                                    "delay":"0"\n                                 }\n                              ]\n                           }\n                        },\n                        "method":"POST",\n                        "delay":0\n                     }\n                  ]\n               ]\n            },\n            "rules":[\n               {\n                  "rule":{\n                     "operator":"equals",\n                     "operand":"webcam"\n                  },\n                  "next":"webcam",\n                  "actions":[\n                     \n                  ]\n               }\n            ],\n            "data":[\n               "webcam"\n            ]\n         },\n         {\n            "type":"button",\n            "name":"webcam",\n            "id":"webcam",\n            "subscription":"/press",\n            "onstart":{\n               "actions":[\n                  [\n                     {\n                        "action":"http://[lenovo]:9102/api/camera",\n                        "params":{\n                           \n                        },\n                        "method":"GET",\n                        "delay":0\n                     }\n                  ]\n               ]\n            },\n            "rules":[\n               {\n                  "rule":{\n                     "operator":"equals",\n                     "operand":""\n                  },\n                  "next":"",\n                  "actions":[\n                     \n                  ]\n               }\n            ],\n            "data":[\n               ""\n            ]\n         }\n      ]\n   }\n]\n')),(0,r.kt)("p",null,'The "events" array consists of all of the nodes that are in an experience (it should probably be called nodes, but there you go). Each node in the events array has an id, the endpoint that it listens on new events from (the "subscription" label), a set of actions that need to be performed when this node is triggered and a set of things that need to happen when an event comes in that matches a rule. You\'ll notice that the actions is a multidimensional array. This allows you specifiy that your actions run in sequence or parallel. So the following:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"actions": [\n\n["a","b","c"],\n\n["d", "e"]\n\n]\n')),(0,r.kt)("p",null,"Would run a then b then c at the same time as d then e. Actions also have a delay in milliseconds which is how long they'll wait before firing. So for example, if you had a video playing and you wanted the caravan voice to say something 5 seconds in, your action might look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"actions":[\n\n[{"action":_url-to-play-something_, "delay":0}],\n\n[{"action": _url-to-say-something_, "delay":5000}],\n\n]\n')),(0,r.kt)("p",null,'You\'ll notice that the urls called by actions have parts of them within square brackets. These are just address placeholders that are filled in at runtime, they relate to the labels defined in src/actions/IPs.json. Note also that actions have options parameters: "params" which can be used to send additional JSON parameters in a POST or query strings in a GET.'),(0,r.kt)("p",null,'Finally there is a "start" level at the top level of the JSON file which just tells the WoZ interface which node it should load up at start (and any pre-actions that need to occur, such as resetting lights, collapsing the camera and so on).'))}p.isMDXComponent=!0}}]);